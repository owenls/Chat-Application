{% extends 'base.html' %}

{% block mycss %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
{% endblock mycss %} 

{% block content %}

<div class="content">
    <div class="message-box">
        <div id="title">
            <h2>Chat Room: {{room.room_name}} {{room.id}}</h2>
            <input id="searchBar" type="text" placeholder="Search...">
            <button type="submit" id="search-btn"><i class="fa fa-search"></i></button>
        </div>
        <div class="messages" id="messages"></div>
        <div class="input">
            <input type="text" rows="3" placeholder="Message" name="message" id="message">
            <button name="send" id="send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>
</div>

<script>
    var socketio = io();

    const messages = document.getElementById("messages")

    const createMessage = (username, msg) => {
        const content = `
        <div>
            <span>
                <strong>${username}</strong>: ${msg}
            </span>
        </div>
        `
        messages.innerHTML += content;
    };

    socketio.on("message", (data) =>{
        createMessage(data.username, data.message);
    });

    const sendMessage = () => {
        const message = document.getElementById("message")
        if (message.value == "") return;
        socketio.emit("new-message", {data: message.value}) //This is an event called new-message, altering the name allows more complicated things.
        message.value = ""; 
    };
    
</script>
{% for msg, username in messages %}
    <script>createMessage("{{ username }}", "{{ msg.data }}")</script>
{% endfor %}


<!-- Adds the ability to just click enter and not have to press "Send" button for messages -->
<script>
    var input = document.getElementById("message");
    input.addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        document.getElementById("send-btn").click();
      }
    });
</script>

{% endblock %}